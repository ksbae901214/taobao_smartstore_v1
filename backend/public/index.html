<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íƒ€ì˜¤ë°”ì˜¤ â†’ ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ìƒí’ˆ ê´€ë¦¬</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Malgun Gothic', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* í—¤ë” */
        .header {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .header h1 {
            font-size: 28px;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .header p { color: #7f8c8d; }
        
        /* í¬ë¡¤ë§ ì…ë ¥ */
        .crawl-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .crawl-form {
            display: flex;
            gap: 15px;
        }
        .crawl-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 15px;
        }
        .crawl-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .crawl-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            white-space: nowrap;
        }
        .crawl-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        .crawl-hint {
            font-size: 13px;
            color: #888;
            margin-top: 10px;
        }
        .crawl-hint a { color: #667eea; }
        
        /* ìƒí’ˆ ëª©ë¡ */
        .products-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .section-title {
            font-size: 20px;
            color: #2c3e50;
        }
        .refresh-btn {
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }
        .refresh-btn:hover { background: #218838; }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        .product-card {
            border: 2px solid #e8e8e8;
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }
        .product-card:hover {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.2);
        }
        .product-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f5f5f5;
        }
        .product-body { padding: 18px; }
        .product-title {
            font-size: 14px;
            color: #2c3e50;
            line-height: 1.4;
            height: 40px;
            overflow: hidden;
            margin-bottom: 12px;
        }
        .product-price {
            font-size: 22px;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 10px;
        }
        .product-stats {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: #888;
        }
        
        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }
        .empty-state .icon { font-size: 60px; margin-bottom: 15px; }
        
        /* ë¡œë”© */
        .loading {
            text-align: center;
            padding: 50px;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f0f0f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }
        .modal.show { display: flex; align-items: flex-start; justify-content: center; }
        .modal-content {
            background: #f8f9fa;
            border-radius: 20px;
            max-width: 900px;
            width: 100%;
            margin: 20px auto;
            overflow: hidden;
        }
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            color: #888;
            background: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            z-index: 10;
        }
        .modal-close:hover { background: #f0f0f0; }
        
        /* ëª¨ë‹¬ ë‚´ìš© */
        .modal-body { padding: 25px; position: relative; }
        
        .info-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .info-card-title {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* ì¸ë„¤ì¼ ê·¸ë¦¬ë“œ */
        .thumb-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
        }
        .thumb-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            background: #f0f0f0;
        }
        .thumb-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .thumb-item:hover { transform: scale(1.05); }
        .thumb-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            color: white;
            font-size: 12px;
            padding: 20px 8px 8px;
            text-align: center;
        }
        
        /* ìƒì„¸ ì´ë¯¸ì§€ ê·¸ë¦¬ë“œ */
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        .detail-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            background: #f0f0f0;
        }
        .detail-item img {
            width: 100%;
            display: block;
        }
        .detail-item:hover { transform: scale(1.02); }
        .detail-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 13px;
            padding: 8px;
            text-align: center;
        }
        
        /* ìƒí’ˆëª… ì„¹ì…˜ */
        .title-section {
            margin-bottom: 15px;
        }
        .title-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }
        .title-cn {
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .title-kr {
            font-size: 16px;
            color: #667eea;
            line-height: 1.5;
        }
        
        /* ê°€ê²© ì„¹ì…˜ */
        .price-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .price-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }
        .price-item .label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }
        .price-item .value {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
        }
        .price-item .value.krw { color: #28a745; }
        
        /* ì˜µì…˜ ì„¹ì…˜ */
        .option-group {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
        }
        .option-name {
            font-size: 14px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .option-values {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .option-value {
            display: inline-flex;
            align-items: flex-start;
            gap: 8px;
            padding: 10px 14px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 13px;
            color: #555;
            min-width: 120px;
        }
        .option-value.out-of-stock {
            background: #f5f5f5;
            border-color: #ddd;
            opacity: 0.6;
        }
        .option-value .option-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .option-value .opt-cn {
            font-weight: 500;
            color: #333;
        }
        .option-value .opt-kr {
            font-size: 12px;
            color: #667eea;
        }
        .option-value .opt-price {
            font-size: 13px;
            color: #ff5000;
            font-weight: bold;
            background: #fff5f0;
            padding: 2px 8px;
            border-radius: 4px;
            margin-top: 3px;
        }
        .option-value .opt-stock {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 2px;
        }
        .option-value .opt-stock.in-stock {
            background: #e8f5e9;
            color: #28a745;
        }
        .option-value .opt-stock.no-stock {
            background: #ffebee;
            color: #dc3545;
        }
        .option-value img {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            object-fit: cover;
        }
        
        /* ì¸ë„¤ì¼ ë“œë˜ê·¸ */
        .thumb-item {
            position: relative;
            cursor: grab;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .thumb-item:hover {
            border-color: #667eea;
            transform: scale(1.02);
        }
        .thumb-item.dragging {
            opacity: 0.5;
            border-color: #ff5000;
            cursor: grabbing;
        }
        .thumb-item.drag-over {
            border-color: #28a745;
            background: #e8f5e9;
        }
        .thumb-order {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 24px;
            height: 24px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            z-index: 10;
        }
        .thumb-drag-hint {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .thumb-item:hover .thumb-drag-hint {
            opacity: 1;
        }
        .thumb-save-btn {
            margin-top: 10px;
            padding: 8px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            display: none;
        }
        .thumb-save-btn.show {
            display: inline-block;
        }
        .thumb-save-btn:hover {
            background: #218838;
        }
        
        /* ì´ë¯¸ì§€ ì•¡ì…˜ ë²„íŠ¼ */
        .img-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 4px;
            z-index: 20;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .thumb-item:hover .img-actions,
        .detail-item:hover .img-actions {
            opacity: 1;
        }
        .img-action-btn {
            width: 26px;
            height: 26px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: transform 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .img-action-btn:hover {
            transform: scale(1.1);
        }
        .img-action-btn.delete {
            background: #dc3545;
            color: white;
        }
        .img-action-btn.edit {
            background: #667eea;
            color: white;
        }
        .img-action-btn.download {
            background: #28a745;
            color: white;
        }
        
        /* ì˜µì…˜ ì•¡ì…˜ ë²„íŠ¼ */
        .option-value {
            position: relative;
        }
        .option-actions {
            position: absolute;
            top: -8px;
            right: -8px;
            display: flex;
            gap: 2px;
            z-index: 20;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .option-value:hover .option-actions {
            opacity: 1;
        }
        .option-action-btn {
            width: 20px;
            height: 20px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        .option-action-btn.delete {
            background: #dc3545;
            color: white;
        }
        .option-action-btn.edit {
            background: #667eea;
            color: white;
        }
        
        /* íŒŒì¼ ì—…ë¡œë“œ ìˆ¨ê¹€ */
        .hidden-upload {
            display: none;
        }
        
        /* í¸ì§‘ ëª¨ë‹¬ */
        .edit-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .edit-modal.show {
            display: flex;
        }
        .edit-modal-content {
            background: white;
            border-radius: 16px;
            padding: 25px;
            max-width: 500px;
            width: 90%;
        }
        .edit-modal-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        .edit-preview {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 10px;
            background: #f0f0f0;
            margin-bottom: 15px;
        }
        .edit-input-group {
            margin-bottom: 15px;
        }
        .edit-input-group label {
            display: block;
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }
        .edit-input-group input[type="text"] {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        .edit-input-group input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        .edit-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .edit-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }
        .edit-buttons .btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .edit-buttons .btn-cancel {
            background: #e0e0e0;
            color: #666;
        }
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 15px;
        }
        .upload-area:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        .upload-area.dragover {
            border-color: #28a745;
            background: #e8f5e9;
        }
        
        /* ë²„íŠ¼ */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }
        
        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            background: #28a745;
            color: white;
            border-radius: 10px;
            font-weight: bold;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 2000;
        }
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.error { background: #dc3545; }
        
        /* ì¹´í…Œê³ ë¦¬ ì„ íƒ */
        .category-item {
            padding: 10px 12px;
            margin: 3px 0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        .category-item:hover {
            background: #f0f0f0;
        }
        .category-item.selected {
            background: #667eea;
            color: white;
        }
        .category-item.has-children::after {
            content: 'â€º';
            float: right;
            font-weight: bold;
        }
        .category-search-item {
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid #e0e0e0;
            transition: all 0.2s;
        }
        .category-search-item:hover {
            background: #f0f4ff;
            border-color: #667eea;
        }
        .category-search-item .path {
            font-size: 12px;
            color: #888;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›’ íƒ€ì˜¤ë°”ì˜¤ â†’ ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´</h1>
            <p>í¬ë¡¬ í™•ì¥ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ìƒí’ˆ ì •ë³´ì™€ ì´ë¯¸ì§€ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤</p>
        </div>
        
        <!-- ë„¤ì´ë²„ API ì¸ì¦ ìƒíƒœ -->
        <div class="naver-auth-section" id="naver-auth-section">
            <div class="auth-status">
                <div class="auth-icon" id="auth-icon">â³</div>
                <div class="auth-info">
                    <div class="auth-title">ë„¤ì´ë²„ ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ API</div>
                    <div class="auth-message" id="auth-message">ì¸ì¦ ìƒíƒœ í™•ì¸ ì¤‘...</div>
                </div>
                <button class="auth-btn" id="auth-btn" onclick="refreshNaverAuth()">ğŸ”„ ì¸ì¦ ê°±ì‹ </button>
            </div>
        </div>
        
        <style>
            .naver-auth-section {
                background: white;
                border-radius: 12px;
                padding: 15px 20px;
                margin-bottom: 20px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            .auth-status {
                display: flex;
                align-items: center;
                gap: 15px;
            }
            .auth-icon {
                font-size: 28px;
                width: 50px;
                height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
                background: #f0f0f0;
            }
            .auth-icon.success {
                background: #d4edda;
            }
            .auth-icon.error {
                background: #f8d7da;
            }
            .auth-icon.warning {
                background: #fff3cd;
            }
            .auth-info {
                flex: 1;
            }
            .auth-title {
                font-weight: 600;
                font-size: 15px;
                color: #2c3e50;
            }
            .auth-message {
                font-size: 13px;
                color: #666;
                margin-top: 4px;
            }
            .auth-message.success { color: #28a745; }
            .auth-message.error { color: #dc3545; }
            .auth-message.warning { color: #856404; }
            .auth-btn {
                padding: 10px 20px;
                background: linear-gradient(135deg, #03c75a, #02b150);
                color: white;
                border: none;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
            }
            .auth-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(3, 199, 90, 0.4);
            }
            .auth-btn:disabled {
                background: #ccc;
                cursor: not-allowed;
                transform: none;
                box-shadow: none;
            }
        </style>
        
        <div class="crawl-section">
            <div class="crawl-form">
                <input type="text" class="crawl-input" id="crawlUrl" 
                       placeholder="https://item.taobao.com/item.htm?id=123456789" 
                       disabled>
                <button class="crawl-btn" disabled>ğŸ” í¬ë¡¤ë§ ì‹œì‘</button>
            </div>
            <p class="crawl-hint">
                ì˜ˆì‹œ: <a href="#">https://item.taobao.com/item.htm?id=123456789</a> ë˜ëŠ” 
                <a href="#">https://detail.tmall.com/item.htm?id=123456789</a>
                <br>â€» í¬ë¡¬ í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš” (URL ì§ì ‘ í¬ë¡¤ë§ì€ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤)
            </p>
        </div>
        
        <div class="products-section">
            <div class="section-header">
                <h2 class="section-title">ğŸ“¦ ìˆ˜ì§‘ëœ ìƒí’ˆ</h2>
                <button class="refresh-btn" onclick="loadProducts()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
            
            <div id="loading" class="loading" style="display:none;">
                <div class="spinner"></div>
                <p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            
            <div id="empty" class="empty-state" style="display:none;">
                <div class="icon">ğŸ“­</div>
                <h3>ìˆ˜ì§‘ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>í¬ë¡¬ í™•ì¥ í”„ë¡œê·¸ë¨ìœ¼ë¡œ íƒ€ì˜¤ë°”ì˜¤ ìƒí’ˆì„ ìˆ˜ì§‘í•´ë³´ì„¸ìš”!</p>
            </div>
            
            <div id="products-grid" class="products-grid"></div>
        </div>
    </div>
    
    <!-- ëª¨ë‹¬ -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">Ã—</button>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>
    
    <div id="toast" class="toast"></div>
    
    <!-- ì´ë¯¸ì§€ í¸ì§‘ ëª¨ë‹¬ -->
    <div id="edit-image-modal" class="edit-modal">
        <div class="edit-modal-content">
            <div class="edit-modal-title" id="edit-image-title">ğŸ–¼ï¸ ì´ë¯¸ì§€ ìˆ˜ì •</div>
            <img id="edit-image-preview" class="edit-preview" src="" alt="ë¯¸ë¦¬ë³´ê¸°">
            <div class="upload-area" id="upload-area" onclick="document.getElementById('image-upload-input').click()">
                ğŸ“ í´ë¦­í•˜ì—¬ ìƒˆ ì´ë¯¸ì§€ ì„ íƒ<br>
                <small style="color:#888;">ë˜ëŠ” ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸ & ë“œë¡­</small>
            </div>
            <input type="file" id="image-upload-input" class="hidden-upload" accept="image/*">
            <div class="edit-buttons">
                <button class="btn-cancel" onclick="closeEditImageModal()">ì·¨ì†Œ</button>
                <button class="btn-save" onclick="downloadCurrentImage()">â¬‡ï¸ ë‹¤ìš´ë¡œë“œ</button>
                <button class="btn-save" id="save-image-btn" onclick="saveEditedImage()" disabled>ğŸ’¾ ì €ì¥</button>
            </div>
        </div>
    </div>
    
    <!-- ì˜µì…˜ í¸ì§‘ ëª¨ë‹¬ -->
    <div id="edit-option-modal" class="edit-modal">
        <div class="edit-modal-content">
            <div class="edit-modal-title">âœï¸ ì˜µì…˜ ìˆ˜ì •</div>
            <div class="edit-input-group">
                <label>ì˜µì…˜ê°’ (ì¤‘êµ­ì–´)</label>
                <input type="text" id="edit-option-cn" placeholder="ì¤‘êµ­ì–´ ì˜µì…˜ê°’">
            </div>
            <div class="edit-input-group">
                <label>ì˜µì…˜ê°’ (í•œêµ­ì–´)</label>
                <input type="text" id="edit-option-kr" placeholder="í•œêµ­ì–´ ì˜µì…˜ê°’">
            </div>
            <div class="edit-input-group">
                <label>íŒë§¤ê°€ê²© (KRW, â‚©)</label>
                <input type="number" id="edit-option-price-krw" placeholder="ì˜ˆ: 15000" step="100" min="0">
                <small style="color:#888; font-size:11px; margin-top:4px; display:block;">ì›í™”ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš” (ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ íŒë§¤ê°€)</small>
            </div>
            <div class="edit-input-group" style="opacity:0.7;">
                <label>íƒ€ì˜¤ë°”ì˜¤ ì›ê°€ (CNY, Â¥) - ì°¸ê³ ìš©</label>
                <input type="number" id="edit-option-price-cny" placeholder="ì˜ˆ: 65.49" step="0.01" min="0" readonly style="background:#f5f5f5;">
            </div>
            <div class="edit-buttons">
                <button class="btn-cancel" onclick="closeEditOptionModal()">ì·¨ì†Œ</button>
                <button class="btn-save" onclick="saveEditedOption()">ğŸ’¾ ì €ì¥</button>
            </div>
        </div>
    </div>
    
    <!-- ìƒí’ˆëª… í¸ì§‘ ëª¨ë‹¬ -->
    <div id="edit-title-modal" class="edit-modal">
        <div class="edit-modal-content">
            <div class="edit-modal-title">ğŸ“ ìƒí’ˆëª… ìˆ˜ì •</div>
            <div class="edit-input-group">
                <label>ìƒí’ˆëª… (ì¤‘êµ­ì–´ ì›ë¬¸)</label>
                <input type="text" id="edit-title-cn" placeholder="ì¤‘êµ­ì–´ ìƒí’ˆëª…">
            </div>
            <div class="edit-input-group">
                <label>ìƒí’ˆëª… (í•œêµ­ì–´)</label>
                <input type="text" id="edit-title-kr" placeholder="í•œêµ­ì–´ ìƒí’ˆëª…">
            </div>
            <div class="edit-buttons">
                <button class="btn-cancel" onclick="closeEditTitleModal()">ì·¨ì†Œ</button>
                <button class="btn-save" onclick="saveEditedTitle()">ğŸ’¾ ì €ì¥</button>
            </div>
        </div>
    </div>
    
    <!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
    <div id="delete-confirm-modal" class="edit-modal">
        <div class="edit-modal-content" style="text-align:center;">
            <div class="edit-modal-title" style="color:#dc3545;">âš ï¸ ìƒí’ˆ ì‚­ì œ</div>
            <p style="margin: 20px 0; font-size: 15px; color: #333;">
                ì´ ìƒí’ˆì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>
                <strong style="color:#dc3545;">ì‚­ì œëœ ìƒí’ˆì€ ë³µì›í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</strong>
            </p>
            <p style="margin: 15px 0; padding: 15px; background: #fff3cd; border-radius: 8px; font-size: 13px; color: #856404;">
                ğŸ’¡ ì‚­ì œí•˜ë©´ ëª¨ë“  ì´ë¯¸ì§€ì™€ ì˜µì…˜ ì •ë³´ê°€ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.
            </p>
            <div class="edit-buttons" style="margin-top: 25px;">
                <button class="btn-cancel" onclick="closeDeleteConfirmModal()">ì·¨ì†Œ</button>
                <button class="btn-save" style="background:#dc3545;" onclick="confirmDeleteProduct()">ğŸ—‘ï¸ ì‚­ì œ</button>
            </div>
        </div>
    </div>
    
    <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ ëª¨ë‹¬ -->
    <div id="category-modal" class="edit-modal">
        <div class="edit-modal-content" style="max-width:700px; max-height:80vh; overflow:hidden; display:flex; flex-direction:column;">
            <div class="edit-modal-title">ğŸ“‚ ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì¹´í…Œê³ ë¦¬ ì„ íƒ</div>
            
            <!-- ê²€ìƒ‰ -->
            <div style="margin-bottom:15px;">
                <input type="text" id="category-search" placeholder="ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ (ì˜ˆ: ì¥ë‚œê°, ì˜ë¥˜, ê°€ë°©...)" 
                       style="width:100%; padding:12px 15px; border:2px solid #e0e0e0; border-radius:8px; font-size:14px;"
                       oninput="searchCategories(this.value)">
            </div>
            
            <!-- ì„ íƒëœ ê²½ë¡œ í‘œì‹œ -->
            <div id="category-breadcrumb" style="margin-bottom:15px; padding:10px 15px; background:#f8f9fa; border-radius:8px; font-size:13px; color:#666; min-height:40px;">
                ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
            </div>
            
            <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ ì˜ì—­ -->
            <div style="display:flex; gap:10px; flex:1; overflow:hidden; min-height:300px;">
                <!-- ëŒ€ë¶„ë¥˜ -->
                <div style="flex:1; border:1px solid #e0e0e0; border-radius:8px; overflow:hidden; display:flex; flex-direction:column;">
                    <div style="padding:10px; background:#667eea; color:white; font-weight:600; font-size:13px;">ëŒ€ë¶„ë¥˜</div>
                    <div id="category-level-1" style="flex:1; overflow-y:auto; padding:5px;"></div>
                </div>
                <!-- ì¤‘ë¶„ë¥˜ -->
                <div style="flex:1; border:1px solid #e0e0e0; border-radius:8px; overflow:hidden; display:flex; flex-direction:column;">
                    <div style="padding:10px; background:#764ba2; color:white; font-weight:600; font-size:13px;">ì¤‘ë¶„ë¥˜</div>
                    <div id="category-level-2" style="flex:1; overflow-y:auto; padding:5px;"></div>
                </div>
                <!-- ì†Œë¶„ë¥˜ -->
                <div style="flex:1; border:1px solid #e0e0e0; border-radius:8px; overflow:hidden; display:flex; flex-direction:column;">
                    <div style="padding:10px; background:#28a745; color:white; font-weight:600; font-size:13px;">ì†Œë¶„ë¥˜</div>
                    <div id="category-level-3" style="flex:1; overflow-y:auto; padding:5px;"></div>
                </div>
                <!-- ì„¸ë¶„ë¥˜ (4ë‹¨ê³„) -->
                <div style="flex:1; border:1px solid #e0e0e0; border-radius:8px; overflow:hidden; display:flex; flex-direction:column;">
                    <div style="padding:10px; background:#20c997; color:white; font-weight:600; font-size:13px;">ì„¸ë¶„ë¥˜</div>
                    <div id="category-level-4" style="flex:1; overflow-y:auto; padding:5px;"></div>
                </div>
            </div>
            
            <!-- ê²€ìƒ‰ ê²°ê³¼ (ê²€ìƒ‰ ì‹œì—ë§Œ í‘œì‹œ) -->
            <div id="category-search-results" style="display:none; flex:1; overflow-y:auto; border:1px solid #e0e0e0; border-radius:8px; padding:10px; min-height:300px;"></div>
            
            <div class="edit-buttons" style="margin-top:20px;">
                <button class="btn-cancel" onclick="closeCategoryModal()">ì·¨ì†Œ</button>
                <button class="btn-save" id="category-save-btn" onclick="saveCategory()" disabled>ğŸ“‚ ì¹´í…Œê³ ë¦¬ ì €ì¥</button>
            </div>
        </div>
    </div>
    
    <script>
        let products = [];
        let currentExchangeRate = 190; // ê¸°ë³¸ê°’
        
        window.onload = async () => {
            await fetchExchangeRate();
            await checkNaverAuthStatus();
            loadProducts();
        };
        
        // ==================== ë„¤ì´ë²„ API ì¸ì¦ ====================
        async function checkNaverAuthStatus() {
            const iconEl = document.getElementById('auth-icon');
            const messageEl = document.getElementById('auth-message');
            const btnEl = document.getElementById('auth-btn');
            
            try {
                const res = await fetch('/api/naver/auth/status');
                const data = await res.json();
                
                if (!data.configured) {
                    // API í‚¤ ë¯¸ì„¤ì •
                    iconEl.textContent = 'âš ï¸';
                    iconEl.className = 'auth-icon warning';
                    messageEl.textContent = 'API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤ (ìƒ˜í”Œ ì¹´í…Œê³ ë¦¬ ì‚¬ìš© ì¤‘)';
                    messageEl.className = 'auth-message warning';
                    btnEl.style.display = 'none';
                } else if (data.authenticated) {
                    // ì¸ì¦ ì„±ê³µ
                    iconEl.textContent = 'âœ…';
                    iconEl.className = 'auth-icon success';
                    const expiresAt = data.status.expiresAt ? new Date(data.status.expiresAt).toLocaleString('ko-KR') : '';
                    messageEl.textContent = `ì¸ì¦ ì™„ë£Œ! (ë§Œë£Œ: ${expiresAt})`;
                    messageEl.className = 'auth-message success';
                    btnEl.textContent = 'ğŸ”„ í† í° ê°±ì‹ ';
                } else {
                    // ì¸ì¦ í•„ìš”
                    iconEl.textContent = 'ğŸ”‘';
                    iconEl.className = 'auth-icon';
                    messageEl.textContent = data.status?.message || 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤';
                    messageEl.className = 'auth-message';
                    btnEl.textContent = 'ğŸ” ì¸ì¦í•˜ê¸°';
                }
            } catch (err) {
                console.error('ì¸ì¦ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', err);
                iconEl.textContent = 'âŒ';
                iconEl.className = 'auth-icon error';
                messageEl.textContent = 'ì„œë²„ ì—°ê²° ì‹¤íŒ¨';
                messageEl.className = 'auth-message error';
            }
        }
        
        async function refreshNaverAuth() {
            const iconEl = document.getElementById('auth-icon');
            const messageEl = document.getElementById('auth-message');
            const btnEl = document.getElementById('auth-btn');
            
            btnEl.disabled = true;
            btnEl.textContent = 'â³ ì¸ì¦ ì¤‘...';
            iconEl.textContent = 'â³';
            iconEl.className = 'auth-icon';
            messageEl.textContent = 'í† í° ë°œê¸‰ ì¤‘...';
            
            try {
                const res = await fetch('/api/naver/auth/token', { method: 'POST' });
                const data = await res.json();
                
                if (data.success) {
                    iconEl.textContent = 'âœ…';
                    iconEl.className = 'auth-icon success';
                    const expiresAt = data.expiresAt ? new Date(data.expiresAt).toLocaleString('ko-KR') : '';
                    messageEl.textContent = `ì¸ì¦ ì„±ê³µ! (ë§Œë£Œ: ${expiresAt})`;
                    messageEl.className = 'auth-message success';
                    btnEl.textContent = 'ğŸ”„ í† í° ê°±ì‹ ';
                    showToast('ë„¤ì´ë²„ API ì¸ì¦ ì™„ë£Œ!');
                } else {
                    iconEl.textContent = 'âŒ';
                    iconEl.className = 'auth-icon error';
                    messageEl.textContent = data.error || 'ì¸ì¦ ì‹¤íŒ¨';
                    messageEl.className = 'auth-message error';
                    btnEl.textContent = 'ğŸ” ë‹¤ì‹œ ì‹œë„';
                    showToast('ë„¤ì´ë²„ API ì¸ì¦ ì‹¤íŒ¨: ' + (data.error || ''), 'error');
                }
            } catch (err) {
                console.error('ì¸ì¦ ì˜¤ë¥˜:', err);
                iconEl.textContent = 'âŒ';
                iconEl.className = 'auth-icon error';
                messageEl.textContent = 'ì¸ì¦ ìš”ì²­ ì‹¤íŒ¨';
                messageEl.className = 'auth-message error';
                btnEl.textContent = 'ğŸ” ë‹¤ì‹œ ì‹œë„';
                showToast('ì¸ì¦ ìš”ì²­ ì‹¤íŒ¨', 'error');
            }
            
            btnEl.disabled = false;
        }
        
        // í™˜ìœ¨ ì¡°íšŒ
        async function fetchExchangeRate() {
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/CNY');
                if (response.ok) {
                    const data = await response.json();
                    currentExchangeRate = Math.round(data.rates.KRW);
                    console.log(`í™˜ìœ¨ ì¡°íšŒ ì„±ê³µ: 1 CNY = ${currentExchangeRate} KRW`);
                }
            } catch (e) {
                console.log('í™˜ìœ¨ ì¡°íšŒ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©:', currentExchangeRate);
            }
        }
        
        // ì¤‘->í•œ ë²ˆì—­ (ì„œë²„ API ì‚¬ìš©, ìºì‹œ ì ìš©)
        const translationCache = new Map();
        
        async function translateText(text) {
            if (!text) return '';
            
            // ìºì‹œ í™•ì¸
            if (translationCache.has(text)) {
                return translationCache.get(text);
            }
            
            try {
                const res = await fetch(`/api/translate/${encodeURIComponent(text)}`);
                const data = await res.json();
                const translation = data.translation || text;
                translationCache.set(text, translation);
                return translation;
            } catch (e) {
                // fallback: ë¡œì»¬ ì‚¬ì „
                return translateTitleLocal(text);
            }
        }
        
        // ì—¬ëŸ¬ í…ìŠ¤íŠ¸ ì¼ê´„ ë²ˆì—­
        async function translateTexts(texts) {
            if (!texts || texts.length === 0) return [];
            
            // ìºì‹œëœ ê²ƒê³¼ ìƒˆë¡œìš´ ê²ƒ ë¶„ë¦¬
            const results = new Array(texts.length);
            const uncached = [];
            const uncachedIndices = [];
            
            texts.forEach((text, i) => {
                if (translationCache.has(text)) {
                    results[i] = translationCache.get(text);
                } else {
                    uncached.push(text);
                    uncachedIndices.push(i);
                }
            });
            
            if (uncached.length > 0) {
                try {
                    const res = await fetch('/api/translate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ texts: uncached })
                    });
                    const data = await res.json();
                    
                    data.translations.forEach((tr, i) => {
                        const originalIdx = uncachedIndices[i];
                        results[originalIdx] = tr;
                        translationCache.set(uncached[i], tr);
                    });
                } catch (e) {
                    // fallback
                    uncached.forEach((text, i) => {
                        const originalIdx = uncachedIndices[i];
                        results[originalIdx] = translateTitleLocal(text);
                    });
                }
            }
            
            return results;
        }
        
        // ë¡œì»¬ ì‚¬ì „ ë²ˆì—­ (fallback, ë™ê¸°ì‹)
        function translateTitleLocal(title) {
            if (!title) return '';
            
            // ê¸´ ë‹¨ì–´ë¶€í„° ë¨¼ì € ë§¤ì¹­í•˜ë„ë¡ ìˆœì„œ ì¤‘ìš”
            const dict = {
                // ì˜µì…˜ ê´€ë ¨
                'é¢œè‰²åˆ†ç±»': 'ìƒ‰ìƒ', 'é¢œè‰²': 'ìƒ‰ìƒ', 'å°ºç ': 'ì‚¬ì´ì¦ˆ', 'å°ºå¯¸': 'ì‚¬ì´ì¦ˆ',
                'è§„æ ¼': 'ê·œê²©', 'å‹å·': 'ëª¨ë¸', 'æ¬¾å¼': 'ìŠ¤íƒ€ì¼', 'ç‰ˆæœ¬': 'ë²„ì „',
                'éšæœº': 'ëœë¤', 'ä¸æŒ‘æ¬¾': 'ëœë¤ë°œì†¡', 'æŒ‘æ¬¾': 'ì§€ì •ê°€ëŠ¥',
                'å…¨æ¬¾': 'ì „ì²´', 'æ•´å¥—': 'í’€ì„¸íŠ¸', 'å•ä¸ª': 'ë‹¨í’ˆ',
                'ç›’': 'ë°•ìŠ¤', 'å¥—': 'ì„¸íŠ¸', 'ä¸ª': 'ê°œ', 'ä»¶': 'ê°œ', 'åª': 'ê°œ',
                'å¤§å·': 'ëŒ€í˜•', 'ä¸­å·': 'ì¤‘í˜•', 'å°å·': 'ì†Œí˜•',
                
                // ë¸Œëœë“œ/ì‹œë¦¬ì¦ˆ
                'ä¹é«˜': 'ë ˆê³ ', 'å¹»å½±å¿è€…': 'ë‹Œìê³ ', 'ç§¯æœ¨': 'ë¸”ë¡', 'æ‹¼è£…': 'ì¡°ë¦½',
                'ç©å…·': 'ì¥ë‚œê°', 'å„¿ç«¥': 'ì•„ë™', 'å­©å­': 'ì•„ì´', 'ç”·å­©': 'ë‚¨ì•„', 'å¥³å­©': 'ì—¬ì•„',
                'ç¤¼ç‰©': 'ì„ ë¬¼', 'ç”Ÿæ—¥': 'ìƒì¼', 'åœ£è¯': 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤', 'èŠ‚æ—¥': 'ëª…ì ˆ',
                
                // ë‹Œìê³  ê´€ë ¨
                'é¾™': 'ë“œë˜ê³¤', 'çŒ›é¾™': 'ë“œë˜ê³¤', 'é›·ç‰™': 'ì¬ë”', 'æ··æ²Œ': 'ì¹´ì˜¤ìŠ¤',
                'å¿è€…': 'ë‹Œì', 'æ­¦å£«': 'ë¬´ì‚¬', 'å¤§å¸ˆ': 'ë§ˆìŠ¤í„°',
                
                // ì˜ë¥˜
                'è¡£æœ': 'ì˜·', 'ä¸Šè¡£': 'ìƒì˜', 'ä¸‹è£…': 'í•˜ì˜', 'å¤–å¥—': 'ì•„ìš°í„°',
                'è£¤å­': 'ë°”ì§€', 'è£™å­': 'ìŠ¤ì»¤íŠ¸', 'è¿è¡£è£™': 'ì›í”¼ìŠ¤',
                'Tæ¤': 'í‹°ì…”ì¸ ', 'è¡¬è¡«': 'ì…”ì¸ ', 'æ¯›è¡£': 'ë‹ˆíŠ¸', 'å«è¡£': 'í›„ë“œí‹°',
                'å¤¹å…‹': 'ìì¼“', 'æ£‰æœ': 'íŒ¨ë”©', 'ç¾½ç»’æœ': 'ë‹¤ìš´ìì¼“',
                
                // ì‹ ë°œ/ê°€ë°©
                'é‹å­': 'ì‹ ë°œ', 'é‹': 'ì‹ ë°œ', 'è¿åŠ¨é‹': 'ìš´ë™í™”', 'çš®é‹': 'êµ¬ë‘',
                'å‡‰é‹': 'ìƒŒë“¤', 'æ‹–é‹': 'ìŠ¬ë¦¬í¼', 'é´å­': 'ë¶€ì¸ ',
                'åŒ…åŒ…': 'ê°€ë°©', 'åŒ…': 'ê°€ë°©', 'èƒŒåŒ…': 'ë°±íŒ©', 'æ‰‹æåŒ…': 'í•¸ë“œë°±',
                'é’±åŒ…': 'ì§€ê°‘', 'æŒåŒ…': 'í¬ë¡œìŠ¤ë°±',
                
                // ì‹œê³„/ì•¡ì„¸ì„œë¦¬
                'æ‰‹è¡¨': 'ì†ëª©ì‹œê³„', 'è…•è¡¨': 'ì‹œê³„', 'æœºæ¢°è¡¨': 'ê¸°ê³„ì‹ ì‹œê³„',
                'çŸ³è‹±è¡¨': 'ì¿¼ì¸  ì‹œê³„', 'ç”µå­è¡¨': 'ì „ìì‹œê³„',
                'é¡¹é“¾': 'ëª©ê±¸ì´', 'æ‰‹é“¾': 'íŒ”ì°Œ', 'æˆ’æŒ‡': 'ë°˜ì§€', 'è€³ç¯': 'ê·€ê±¸ì´',
                
                // ìƒ‰ìƒ
                'é»‘è‰²': 'ë¸”ë™', 'ç™½è‰²': 'í™”ì´íŠ¸', 'çº¢è‰²': 'ë ˆë“œ', 'è“è‰²': 'ë¸”ë£¨',
                'ç»¿è‰²': 'ê·¸ë¦°', 'é»„è‰²': 'ì˜ë¡œìš°', 'ç²‰è‰²': 'í•‘í¬', 'ç´«è‰²': 'í¼í”Œ',
                'ç°è‰²': 'ê·¸ë ˆì´', 'æ£•è‰²': 'ë¸Œë¼ìš´', 'ç±³è‰²': 'ë² ì´ì§€', 'æ©™è‰²': 'ì˜¤ë Œì§€',
                'é‡‘è‰²': 'ê³¨ë“œ', 'é“¶è‰²': 'ì‹¤ë²„', 'å½©è‰²': 'ë©€í‹°ì»¬ëŸ¬',
                
                // ì‚¬ì´ì¦ˆ
                'å¤§ç ': 'ë¹…ì‚¬ì´ì¦ˆ', 'å°ç ': 'ìŠ¤ëª°ì‚¬ì´ì¦ˆ', 'å‡ç ': 'í”„ë¦¬ì‚¬ì´ì¦ˆ',
                'åŠ å¤§': 'XL', 'åŠ å°': 'XS',
                
                // ì„±ë³„/ëŒ€ìƒ
                'ç”·': 'ë‚¨ì„±', 'å¥³': 'ì—¬ì„±', 'ç«¥': 'ì•„ë™', 'ä¸­æ€§': 'ìœ ë‹ˆì„¹ìŠ¤',
                'æƒ…ä¾£': 'ì»¤í”Œ', 'äº²å­': 'ê°€ì¡±',
                
                // ê³„ì ˆ
                'å¤å­£': 'ì—¬ë¦„', 'å¤å¤©': 'ì—¬ë¦„', 'å¤': 'ì—¬ë¦„',
                'å†¬å­£': 'ê²¨ìš¸', 'å†¬å¤©': 'ê²¨ìš¸', 'å†¬': 'ê²¨ìš¸',
                'æ˜¥å­£': 'ë´„', 'æ˜¥å¤©': 'ë´„', 'æ˜¥': 'ë´„',
                'ç§‹å­£': 'ê°€ì„', 'ç§‹å¤©': 'ê°€ì„', 'ç§‹': 'ê°€ì„',
                'å››å­£': 'ì‚¬ê³„ì ˆ',
                
                // ìŠ¤íƒ€ì¼
                'éŸ©ç‰ˆ': 'í•œêµ­ìŠ¤íƒ€ì¼', 'éŸ©å›½': 'í•œêµ­', 'æ—¥ç³»': 'ì¼ë³¸ìŠ¤íƒ€ì¼', 'æ—¥æœ¬': 'ì¼ë³¸',
                'æ¬§ç¾': 'ìœ ëŸ½ìŠ¤íƒ€ì¼', 'å¤å¤': 'ë ˆíŠ¸ë¡œ', 'æ½®æµ': 'íŠ¸ë Œë””',
                'ç®€çº¦': 'ì‹¬í”Œ', 'ç™¾æ­': 'ë°ì¼ë¦¬', 'ä¼‘é—²': 'ìºì£¼ì–¼',
                'è¿åŠ¨': 'ìŠ¤í¬ì¸ ', 'æ—¶å°š': 'íŒ¨ì…˜', 'ä¼˜é›…': 'ì—˜ë ˆê°•ìŠ¤',
                
                // í’ˆì§ˆ/íŠ¹ì„±
                'é«˜çº§': 'ê³ ê¸‰', 'é«˜ç«¯': 'í”„ë¦¬ë¯¸ì—„', 'å¥¢å': 'ëŸ­ì…”ë¦¬',
                'æ­£å“': 'ì •í’ˆ', 'åŸè£…': 'ì˜¤ë¦¬ì§€ë„', 'å®˜æ–¹': 'ê³µì‹',
                'æ–°æ¬¾': 'ì‹ ìƒ', 'æ–°å“': 'ì‹ ìƒí’ˆ', 'çƒ­å–': 'ë² ìŠ¤íŠ¸ì…€ëŸ¬',
                'çˆ†æ¬¾': 'ì¸ê¸°ìƒí’ˆ', 'é™å®š': 'í•œì •íŒ', 'ç‰¹ä»·': 'íŠ¹ê°€',
                'åŒ…é‚®': 'ë¬´ë£Œë°°ì†¡', 'ç°è´§': 'ë‹¹ì¼ë°œì†¡',
                
                // ê¸°ëŠ¥
                'é˜²æ°´': 'ë°©ìˆ˜', 'é˜²æ™’': 'ìì™¸ì„ ì°¨ë‹¨', 'é€æ°”': 'í†µê¸°ì„±',
                'ä¿æš–': 'ë³´ì˜¨', 'è½»ä¾¿': 'ê²½ëŸ‰', 'è€ç£¨': 'ë‚´êµ¬ì„±',
                
                // ì „ìì œí’ˆ
                'æ‰‹æœº': 'íœ´ëŒ€í°', 'æ‰‹æ©Ÿ': 'íœ´ëŒ€í°', 'ç”µè„‘': 'ì»´í“¨í„°',
                'å¹³æ¿': 'íƒœë¸”ë¦¿', 'è€³æœº': 'ì´ì–´í°', 'å……ç”µå™¨': 'ì¶©ì „ê¸°',
                'æ•°æ®çº¿': 'ì¼€ì´ë¸”', 'ä¿æŠ¤å£³': 'ì¼€ì´ìŠ¤', 'è´´è†œ': 'í•„ë¦„',
                
                // ê¸°íƒ€ ëª…ì‚¬
                'ç³»åˆ—': 'ì‹œë¦¬ì¦ˆ', 'å¥—è£…': 'ì„¸íŠ¸', 'ç»„åˆ': 'ì„¸íŠ¸',
                'æ¦‚å¿µ': 'ì»¨ì…‰', 'è®¾è®¡': 'ë””ìì¸', 'å“ç‰Œ': 'ë¸Œëœë“œ',
                'æ¬¾å¼': 'ìŠ¤íƒ€ì¼', 'ç‰ˆå‹': 'í•', 'æè´¨': 'ì†Œì¬',
                'è£…é¥°': 'ì¥ì‹', 'æ‘†ä»¶': 'ì†Œí’ˆ', 'é…ä»¶': 'ì•¡ì„¸ì„œë¦¬',
                
                // ë™ë¬¼
                'é©¯é¹¿': 'ìˆœë¡', 'çŒ«': 'ê³ ì–‘ì´', 'ç‹—': 'ê°•ì•„ì§€',
                'ç†Š': 'ê³°', 'å…”': 'í† ë¼', 'é¸Ÿ': 'ìƒˆ',
                
                // ì¤‘êµ­ íŠ¹ì •
                'ä¸­å›½': 'ì¤‘êµ­',
                
                // ìˆ«ì/ë‹¨ìœ„ (ê·¸ëŒ€ë¡œ ìœ ì§€)
                'æ¬¾': 'ì¢…ë¥˜', 'ä»¶': 'ê°œ', 'åŒ': 'ì¼¤ë ˆ', 'å¥—': 'ì„¸íŠ¸'
            };
            
            let result = title;
            
            // ê¸´ ë‹¨ì–´ë¶€í„° ë¨¼ì € ì¹˜í™˜ (ì •í™•í•œ ë§¤ì¹­ì„ ìœ„í•´)
            const sortedKeys = Object.keys(dict).sort((a, b) => b.length - a.length);
            for (const cn of sortedKeys) {
                result = result.replace(new RegExp(cn, 'g'), dict[cn]);
            }
            
            // ìˆ«ìì™€ ì˜ë¬¸ì€ ê·¸ëŒ€ë¡œ ìœ ì§€, ë„ì–´ì“°ê¸° ì •ë¦¬
            result = result.replace(/\s+/g, ' ').trim();
            
            return result;
        }
        
        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        async function loadProducts() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('empty').style.display = 'none';
            document.getElementById('products-grid').innerHTML = '';
            
            try {
                const res = await fetch('/api/products/extracted');
                const data = await res.json();
                products = data.products || [];
                
                document.getElementById('loading').style.display = 'none';
                
                if (products.length === 0) {
                    document.getElementById('empty').style.display = 'block';
                    return;
                }
                
                const grid = document.getElementById('products-grid');
                grid.innerHTML = products.map(p => {
                    const rate = p.exchange_rate || currentExchangeRate;
                    const krwPrice = Math.round((p.price || 0) * rate);
                    return `
                    <div class="product-card" onclick="showDetail('${p.product_id}')">
                        <img class="product-img" 
                             src="${p.thumbnail || ''}" 
                             alt="${p.title || 'ìƒí’ˆ'}"
                             onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22><rect fill=%22%23f5f5f5%22 width=%22100%%22 height=%22100%%22/><text x=%2250%%22 y=%2250%%22 text-anchor=%22middle%22 fill=%22%23ccc%22 font-size=%2214%22>No Image</text></svg>'">
                        <div class="product-body">
                            <div class="product-title">${p.title || 'ì œëª© ì—†ìŒ'}</div>
                            <div class="product-price">Â¥${p.price || 0} <span style="font-size:14px;color:#28a745;">â‚©${krwPrice.toLocaleString()}</span></div>
                            <div class="product-stats">
                                <span>ğŸ–¼ ${p.images_count || 0}</span>
                                <span>ğŸ“· ${p.detail_images_count || 0}</span>
                                <span>ğŸ¨ ${p.options_count || 0}</span>
                            </div>
                        </div>
                    </div>
                `}).join('');
                
            } catch (err) {
                console.error(err);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('empty').style.display = 'block';
            }
        }
        
        async function showDetail(id) {
            try {
                const res = await fetch(`/api/products/extracted/${id}`);
                const p = await res.json();
                
                // ì¸ë„¤ì¼ ì´ë¯¸ì§€ (ë“œë˜ê·¸ ì •ë ¬ ê°€ëŠ¥)
                const thumbsHtml = (p.images?.length > 0)
                    ? p.images.map((url, i) => `
                        <div class="thumb-item" draggable="true" data-index="${i}" data-url="${url}">
                            <div class="thumb-order">${i+1}</div>
                            <div class="img-actions">
                                <button class="img-action-btn edit" onclick="event.stopPropagation(); openEditImage('thumb', ${i}, '${url}', '${id}')" title="ìˆ˜ì •">âœï¸</button>
                                <button class="img-action-btn delete" onclick="event.stopPropagation(); deleteImage('thumb', ${i}, '${id}')" title="ì‚­ì œ">âœ•</button>
                            </div>
                            <img src="${url}" alt="ì¸ë„¤ì¼ ${i+1}" onerror="this.style.opacity='0.3'; this.style.border='2px dashed #dc3545';">
                            <div class="thumb-label">ì¸ë„¤ì¼ ${i+1}</div>
                            <div class="thumb-drag-hint">â†• ë“œë˜ê·¸</div>
                        </div>
                    `).join('')
                    : '<p style="color:#888;text-align:center;padding:20px;">ì¸ë„¤ì¼ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                
                // ìƒì„¸ ì´ë¯¸ì§€
                const detailsHtml = (p.detail_images?.length > 0)
                    ? p.detail_images.map((url, i) => `
                        <div class="detail-item">
                            <div class="img-actions">
                                <button class="img-action-btn edit" onclick="event.stopPropagation(); openEditImage('detail', ${i}, '${url}', '${id}')" title="ìˆ˜ì •">âœï¸</button>
                                <button class="img-action-btn delete" onclick="event.stopPropagation(); deleteImage('detail', ${i}, '${id}')" title="ì‚­ì œ">âœ•</button>
                            </div>
                            <img src="${url}" alt="ìƒì„¸ ${i+1}" onclick="window.open('${url}','_blank')" style="cursor:pointer;" onerror="this.style.opacity='0.3'; this.style.border='2px dashed #dc3545';">
                            <div class="detail-label">ìƒì„¸ ${i+1}</div>
                        </div>
                    `).join('')
                    : '<p style="color:#888;text-align:center;padding:20px;">ìƒì„¸ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
                
                // ê°€ê²© ê³„ì‚° (ì €ì¥ëœ í™˜ìœ¨ ë˜ëŠ” í˜„ì¬ í™˜ìœ¨ ì‚¬ìš©) - ì˜µì…˜ì—ì„œë„ ì‚¬ìš©í•˜ë¯€ë¡œ ë¨¼ì € ê³„ì‚°
                const rate = p.exchange_rate || currentExchangeRate;
                const cnyPrice = p.price || 0;
                const krwPrice = Math.round(cnyPrice * rate);
                
                // ì˜µì…˜ ë²ˆì—­ ì¤€ë¹„ - ëª¨ë“  í…ìŠ¤íŠ¸ ìˆ˜ì§‘
                const textsToTranslate = [];
                if (p.options?.length > 0) {
                    p.options.forEach(opt => {
                        textsToTranslate.push(opt.name || 'ì˜µì…˜');
                        opt.values.forEach(v => {
                            if (!v.name_kr) {
                                textsToTranslate.push(v.name || '');
                            }
                        });
                    });
                }
                textsToTranslate.push(p.title || '');
                
                // ì¼ê´„ ë²ˆì—­ ìˆ˜í–‰
                const translations = await translateTexts(textsToTranslate);
                let transIdx = 0;
                
                // ì˜µì…˜ (ë²ˆì—­ ì ìš©)
                const optionsHtml = (p.options?.length > 0)
                    ? p.options.map((opt, optIdx) => {
                        const translatedOptName = translations[transIdx++] || translateTitleLocal(opt.name || 'ì˜µì…˜');
                        return `
                        <div class="option-group" data-opt-idx="${optIdx}">
                            <div class="option-name">
                                ${opt.name || 'ì˜µì…˜'}
                                <span style="color:#667eea; font-size:13px; margin-left:8px;">(${translatedOptName})</span>
                            </div>
                            <div class="option-values">
                                ${opt.values.map((v, valIdx) => {
                                    const valueName = v.name || v;
                                    // ì €ì¥ëœ í•œêµ­ì–´ ë²ˆì—­ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ API ë²ˆì—­ ê²°ê³¼ ì‚¬ìš©
                                    const translatedValueName = v.name_kr || translations[transIdx++] || translateTitleLocal(valueName);
                                    const quantity = v.quantity ?? null;
                                    const price = v.price || null;
                                    const hasStock = quantity === null || quantity > 0;
                                    
                                    // ì›í™” í™˜ì‚° (í™˜ìœ¨ ì‚¬ìš©) - v.price_krwê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©
                                    const priceNum = price ? parseFloat(price) : 0;
                                    const optKrwPrice = v.price_krw || Math.round(priceNum * rate);
                                    
                                    return `
                                    <span class="option-value ${!hasStock ? 'out-of-stock' : ''}" title="${quantity !== null ? 'ì¬ê³ : ' + quantity + 'ê°œ' : ''}" data-opt-idx="${optIdx}" data-val-idx="${valIdx}">
                                        <div class="option-actions">
                                            <button class="option-action-btn edit" onclick="event.stopPropagation(); openEditOption(${optIdx}, ${valIdx}, '${valueName.replace(/'/g, "\\'")}', '${translatedValueName.replace(/'/g, "\\'")}', ${optKrwPrice || 'null'}, ${price || 'null'}, '${id}')" title="ìˆ˜ì •">âœï¸</button>
                                            <button class="option-action-btn delete" onclick="event.stopPropagation(); deleteOption(${optIdx}, ${valIdx}, '${id}')" title="ì‚­ì œ">âœ•</button>
                                        </div>
                                        ${v.image ? `<img src="${v.image}" onerror="this.style.display='none'">` : ''}
                                        <span class="option-text">
                                            <span class="opt-cn">${valueName}</span>
                                            <span class="opt-kr">${translatedValueName}</span>
                                            <span class="opt-price">${price ? `â‚©${optKrwPrice.toLocaleString()} <small style="color:#888;">(Â¥${price})</small>` : 'ê°€ê²© ë¯¸ì„¤ì •'}</span>
                                            ${quantity !== null ? `<span class="opt-stock ${hasStock ? 'in-stock' : 'no-stock'}">${hasStock ? 'ì¬ê³ : ' + quantity : 'í’ˆì ˆ'}</span>` : ''}
                                        </span>
                                    </span>
                                `}).join('')}
                            </div>
                        </div>
                    `}).join('')
                    : '<p style="color:#888;">ì˜µì…˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
                
                // ì œëª© ë²ˆì—­ (ì´ë¯¸ translateTextsì—ì„œ ë§ˆì§€ë§‰ì— ì¶”ê°€í•¨)
                const translatedTitle = translations[translations.length - 1] || translateTitleLocal(p.title);
                
                document.getElementById('modal-body').innerHTML = `
                    <!-- ì¸ë„¤ì¼ ì´ë¯¸ì§€ -->
                    <div class="info-card">
                        <div class="info-card-title">
                            ğŸ“· ì¸ë„¤ì¼ ì´ë¯¸ì§€ <span style="color:#888;font-weight:normal;">(${p.images?.length || 0}ê°œ)</span>
                            <span style="font-size:12px;color:#667eea;margin-left:10px;">ğŸ’¡ ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œ ë³€ê²½</span>
                        </div>
                        <div class="thumb-grid" id="thumb-grid-sortable" data-product-id="${id}">${thumbsHtml}</div>
                        <button class="thumb-save-btn" id="thumb-save-btn" onclick="saveThumbOrder('${id}')">ğŸ’¾ ìˆœì„œ ì €ì¥</button>
                    </div>
                    
                    <!-- ìƒí’ˆëª… -->
                    <div class="info-card">
                        <div class="info-card-title">
                            ğŸ“¦ ìƒí’ˆëª…
                            <button id="edit-title-btn" data-product-id="${id}" style="margin-left:auto; padding:5px 12px; background:#667eea; color:white; border:none; border-radius:6px; font-size:12px; cursor:pointer;">âœï¸ ìˆ˜ì •</button>
                        </div>
                        <div class="title-section">
                            <div class="title-label">ì¤‘êµ­ì–´ ì›ë¬¸</div>
                            <div class="title-cn" id="current-title-cn">${p.title || '-'}</div>
                            <div class="title-label">í•œêµ­ì–´ ${p.title_kr ? '' : '(ìë™ ë²ˆì—­)'}</div>
                            <div class="title-kr" id="current-title-kr">${p.title_kr || translatedTitle || 'ë²ˆì—­ ë¶ˆê°€'}</div>
                        </div>
                    </div>
                    
                    <!-- ê°€ê²© -->
                    <div class="info-card">
                        <div class="info-card-title">ğŸ’° ìƒí’ˆ ê°€ê²©</div>
                        <div class="price-section">
                            <div class="price-item">
                                <div class="label">íƒ€ì˜¤ë°”ì˜¤ ê°€ê²© (CNY)</div>
                                <div class="value">Â¥${cnyPrice.toFixed(2)}</div>
                            </div>
                            <div class="price-item">
                                <div class="label">í•œêµ­ ì›í™” (í™˜ìœ¨ ${rate}ì› ê¸°ì¤€)</div>
                                <div class="value krw">â‚©${krwPrice.toLocaleString()}ì›</div>
                            </div>
                        </div>
                        ${p.price_range ? `<p style="margin-top:10px;color:#888;font-size:13px;">ê°€ê²© ë²”ìœ„: Â¥${p.price_range}</p>` : ''}
                    </div>
                    
                    <!-- ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì¹´í…Œê³ ë¦¬ -->
                    <div class="info-card">
                        <div class="info-card-title">
                            ğŸ“‚ ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì¹´í…Œê³ ë¦¬
                            <button onclick="openCategoryModal('${id}')" style="margin-left:auto; padding:5px 12px; background:#28a745; color:white; border:none; border-radius:6px; font-size:12px; cursor:pointer;">ğŸ“‚ ì¹´í…Œê³ ë¦¬ ì„ íƒ</button>
                        </div>
                        <div class="category-section" style="padding:15px;">
                            ${p.naver_category_path 
                                ? `<div style="display:flex; align-items:center; gap:10px;">
                                      <span style="color:#28a745; font-size:20px;">âœ“</span>
                                      <div>
                                          <div style="font-weight:600; color:#2c3e50;">${p.naver_category_name || 'ì¹´í…Œê³ ë¦¬ ì„ íƒë¨'}</div>
                                          <div style="font-size:12px; color:#888; margin-top:4px;">${p.naver_category_path}</div>
                                      </div>
                                   </div>`
                                : `<div style="color:#888; text-align:center; padding:20px;">
                                      <span style="font-size:24px;">ğŸ“</span><br>
                                      <span style="margin-top:8px; display:block;">ì¹´í…Œê³ ë¦¬ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</span>
                                      <span style="font-size:12px; color:#aaa;">ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ë“±ë¡ì„ ìœ„í•´ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>
                                   </div>`
                            }
                        </div>
                    </div>
                    
                    <!-- ì˜µì…˜ -->
                    <div class="info-card">
                        <div class="info-card-title">âš™ï¸ ìƒí’ˆ ì˜µì…˜ <span style="color:#888;font-weight:normal;">(${p.options?.length || 0}ê°œ)</span></div>
                        ${optionsHtml}
                    </div>
                    
                    <!-- ìƒì„¸ ì´ë¯¸ì§€ -->
                    <div class="info-card">
                        <div class="info-card-title">ğŸ–¼ï¸ ìƒì„¸ ì´ë¯¸ì§€ <span style="color:#888;font-weight:normal;">(${p.detail_images?.length || 0}ê°œ)</span></div>
                        <div class="detail-grid">${detailsHtml}</div>
                    </div>
                    
                    <!-- ë²„íŠ¼ -->
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="window.open('${p.source_url}','_blank')">
                            ğŸ”— íƒ€ì˜¤ë°”ì˜¤ì—ì„œ ë³´ê¸°
                        </button>
                        <button class="btn btn-danger" onclick="openDeleteConfirm('${id}')">
                            ğŸ—‘ï¸ ì‚­ì œ
                        </button>
                    </div>
                `;
                
                document.getElementById('modal').classList.add('show');
                
                // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ˆê¸°í™”
                initThumbDragDrop();
                
                // ìƒí’ˆëª… í¸ì§‘ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
                const editTitleBtn = document.getElementById('edit-title-btn');
                if (editTitleBtn) {
                    editTitleBtn.onclick = () => {
                        const cnTitle = document.getElementById('current-title-cn')?.textContent || '';
                        const krTitle = document.getElementById('current-title-kr')?.textContent || '';
                        openEditTitle(cnTitle, krTitle, id);
                    };
                }
                
            } catch (err) {
                console.error(err);
                showToast('ìƒí’ˆ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨', 'error');
            }
        }
        
        // ì¸ë„¤ì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­
        let draggedItem = null;
        let thumbOrderChanged = false;
        
        function initThumbDragDrop() {
            const grid = document.getElementById('thumb-grid-sortable');
            if (!grid) return;
            
            const items = grid.querySelectorAll('.thumb-item');
            
            items.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('dragenter', handleDragEnter);
                item.addEventListener('dragleave', handleDragLeave);
                item.addEventListener('drop', handleDrop);
            });
        }
        
        function handleDragStart(e) {
            draggedItem = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', this.dataset.index);
        }
        
        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.thumb-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }
        
        function handleDragEnter(e) {
            e.preventDefault();
            if (this !== draggedItem) {
                this.classList.add('drag-over');
            }
        }
        
        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            
            if (this !== draggedItem) {
                const grid = this.parentNode;
                const allItems = [...grid.querySelectorAll('.thumb-item')];
                const draggedIdx = allItems.indexOf(draggedItem);
                const dropIdx = allItems.indexOf(this);
                
                if (draggedIdx < dropIdx) {
                    grid.insertBefore(draggedItem, this.nextSibling);
                } else {
                    grid.insertBefore(draggedItem, this);
                }
                
                // ìˆœì„œ ë²ˆí˜¸ ì—…ë°ì´íŠ¸
                updateThumbNumbers();
                
                // ì €ì¥ ë²„íŠ¼ í‘œì‹œ
                thumbOrderChanged = true;
                document.getElementById('thumb-save-btn').classList.add('show');
            }
        }
        
        function updateThumbNumbers() {
            const grid = document.getElementById('thumb-grid-sortable');
            const items = grid.querySelectorAll('.thumb-item');
            items.forEach((item, idx) => {
                item.querySelector('.thumb-order').textContent = idx + 1;
                item.querySelector('.thumb-label').textContent = `ì¸ë„¤ì¼ ${idx + 1}`;
                item.dataset.index = idx;
            });
        }
        
        async function saveThumbOrder(productId) {
            const grid = document.getElementById('thumb-grid-sortable');
            const items = grid.querySelectorAll('.thumb-item');
            const newOrder = [...items].map(item => item.dataset.url);
            
            try {
                const res = await fetch(`/api/products/extracted/${productId}/images`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ images: newOrder })
                });
                
                if (res.ok) {
                    showToast('ì¸ë„¤ì¼ ìˆœì„œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
                    document.getElementById('thumb-save-btn').classList.remove('show');
                    thumbOrderChanged = false;
                    loadProducts(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    throw new Error('ì €ì¥ ì‹¤íŒ¨');
                }
            } catch (err) {
                console.error(err);
                showToast('ìˆœì„œ ì €ì¥ ì‹¤íŒ¨', 'error');
            }
        }
        
        function closeModal() {
            document.getElementById('modal').classList.remove('show');
        }
        
        async function deleteProduct(id) {
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                await fetch(`/api/products/extracted/${id}`, { method: 'DELETE' });
                closeModal();
                loadProducts();
                showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            } catch (err) {
                showToast('ì‚­ì œ ì‹¤íŒ¨', 'error');
            }
        }
        
        // ==================== ì´ë¯¸ì§€ ì‚­ì œ/ìˆ˜ì • ====================
        let currentEditImage = { type: null, index: null, url: null, productId: null };
        let newImageData = null;
        
        // ì´ë¯¸ì§€ ì‚­ì œ
        async function deleteImage(type, index, productId) {
            const typeKr = type === 'thumb' ? 'ì¸ë„¤ì¼' : 'ìƒì„¸ ì´ë¯¸ì§€';
            if (!confirm(`${typeKr} ${index + 1}ë²ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                const res = await fetch(`/api/products/extracted/${productId}`);
                const product = await res.json();
                
                if (type === 'thumb') {
                    product.images.splice(index, 1);
                    await fetch(`/api/products/extracted/${productId}/images`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ images: product.images })
                    });
                } else {
                    product.detail_images.splice(index, 1);
                    await fetch(`/api/products/extracted/${productId}/detail-images`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ detail_images: product.detail_images })
                    });
                }
                
                showToast(`${typeKr}ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤`);
                showDetail(productId); // ëª¨ë‹¬ ìƒˆë¡œê³ ì¹¨
                loadProducts(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } catch (err) {
                console.error(err);
                showToast('ì‚­ì œ ì‹¤íŒ¨', 'error');
            }
        }
        
        // ì´ë¯¸ì§€ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        function openEditImage(type, index, url, productId) {
            currentEditImage = { type, index, url, productId };
            newImageData = null;
            
            const typeKr = type === 'thumb' ? 'ì¸ë„¤ì¼' : 'ìƒì„¸ ì´ë¯¸ì§€';
            document.getElementById('edit-image-title').textContent = `ğŸ–¼ï¸ ${typeKr} ${index + 1} ìˆ˜ì •`;
            document.getElementById('edit-image-preview').src = url;
            document.getElementById('save-image-btn').disabled = true;
            document.getElementById('edit-image-modal').classList.add('show');
        }
        
        // ì´ë¯¸ì§€ ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditImageModal() {
            document.getElementById('edit-image-modal').classList.remove('show');
            currentEditImage = { type: null, index: null, url: null, productId: null };
            newImageData = null;
        }
        
        // í˜„ì¬ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
        function downloadCurrentImage() {
            const url = currentEditImage.url;
            const a = document.createElement('a');
            a.href = url;
            a.download = `image_${currentEditImage.type}_${currentEditImage.index + 1}.jpg`;
            a.target = '_blank';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            showToast('ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤');
        }
        
        // ìƒˆ ì´ë¯¸ì§€ ì„ íƒ ì²˜ë¦¬
        document.getElementById('image-upload-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                handleImageFile(file);
            }
        });
        
        // ë“œë˜ê·¸ & ë“œë¡­ ì²˜ë¦¬
        const uploadArea = document.getElementById('upload-area');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                handleImageFile(file);
            }
        });
        
        // ì´ë¯¸ì§€ íŒŒì¼ ì²˜ë¦¬
        function handleImageFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                newImageData = e.target.result;
                document.getElementById('edit-image-preview').src = newImageData;
                document.getElementById('save-image-btn').disabled = false;
                showToast('ìƒˆ ì´ë¯¸ì§€ê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤');
            };
            reader.readAsDataURL(file);
        }
        
        // ìˆ˜ì •ëœ ì´ë¯¸ì§€ ì €ì¥
        async function saveEditedImage() {
            if (!newImageData) return;
            
            try {
                const { type, index, productId } = currentEditImage;
                const res = await fetch(`/api/products/extracted/${productId}`);
                const product = await res.json();
                
                if (type === 'thumb') {
                    product.images[index] = newImageData;
                    await fetch(`/api/products/extracted/${productId}/images`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ images: product.images })
                    });
                } else {
                    product.detail_images[index] = newImageData;
                    await fetch(`/api/products/extracted/${productId}/detail-images`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ detail_images: product.detail_images })
                    });
                }
                
                showToast('ì´ë¯¸ì§€ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
                closeEditImageModal();
                showDetail(productId);
                loadProducts();
            } catch (err) {
                console.error(err);
                showToast('ì´ë¯¸ì§€ ìˆ˜ì • ì‹¤íŒ¨', 'error');
            }
        }
        
        // ==================== ì˜µì…˜ ì‚­ì œ/ìˆ˜ì • ====================
        let currentEditOption = { optIdx: null, valIdx: null, productId: null };
        
        // ì˜µì…˜ ì‚­ì œ
        async function deleteOption(optIdx, valIdx, productId) {
            if (!confirm(`ì´ ì˜µì…˜ê°’ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                const res = await fetch(`/api/products/extracted/${productId}`);
                const product = await res.json();
                
                // í•´ë‹¹ ì˜µì…˜ì˜ ê°’ ì‚­ì œ
                product.options[optIdx].values.splice(valIdx, 1);
                
                // ì˜µì…˜ ê·¸ë£¹ì— ê°’ì´ ì—†ìœ¼ë©´ ì˜µì…˜ ê·¸ë£¹ë„ ì‚­ì œ
                if (product.options[optIdx].values.length === 0) {
                    product.options.splice(optIdx, 1);
                }
                
                await fetch(`/api/products/extracted/${productId}/options`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ options: product.options })
                });
                
                showToast('ì˜µì…˜ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                showDetail(productId);
                loadProducts();
            } catch (err) {
                console.error(err);
                showToast('ì˜µì…˜ ì‚­ì œ ì‹¤íŒ¨', 'error');
            }
        }
        
        // ì˜µì…˜ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸° (krwPrice: ì›í™”ê°€ê²©, cnyPrice: ìœ„ì•ˆí™”ê°€ê²©)
        function openEditOption(optIdx, valIdx, cnName, krName, krwPrice, cnyPrice, productId) {
            currentEditOption = { optIdx, valIdx, productId };
            document.getElementById('edit-option-cn').value = cnName;
            document.getElementById('edit-option-kr').value = krName;
            document.getElementById('edit-option-price-krw').value = krwPrice || '';
            document.getElementById('edit-option-price-cny').value = cnyPrice || '';
            document.getElementById('edit-option-modal').classList.add('show');
        }
        
        // ì˜µì…˜ ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditOptionModal() {
            document.getElementById('edit-option-modal').classList.remove('show');
            currentEditOption = { optIdx: null, valIdx: null, productId: null };
        }
        
        // ìˆ˜ì •ëœ ì˜µì…˜ ì €ì¥
        async function saveEditedOption() {
            const { optIdx, valIdx, productId } = currentEditOption;
            const newCnName = document.getElementById('edit-option-cn').value.trim();
            const newKrName = document.getElementById('edit-option-kr').value.trim();
            const newKrwPrice = document.getElementById('edit-option-price-krw').value;
            
            if (!newCnName) {
                showToast('ì˜µì…˜ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }
            
            try {
                const res = await fetch(`/api/products/extracted/${productId}`);
                const product = await res.json();
                
                // ì˜µì…˜ê°’ ìˆ˜ì • (ì›í™” ê°€ê²© ì €ì¥, ìœ„ì•ˆí™”ëŠ” ì›ë³¸ ìœ ì§€)
                product.options[optIdx].values[valIdx].name = newCnName;
                product.options[optIdx].values[valIdx].name_kr = newKrName;
                product.options[optIdx].values[valIdx].price_krw = newKrwPrice ? parseInt(newKrwPrice) : null;
                // product.options[optIdx].values[valIdx].price ëŠ” íƒ€ì˜¤ë°”ì˜¤ ì›ê°€ë¡œ ìœ ì§€
                
                await fetch(`/api/products/extracted/${productId}/options`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ options: product.options })
                });
                
                showToast('ì˜µì…˜ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
                closeEditOptionModal();
                showDetail(productId);
                loadProducts();
            } catch (err) {
                console.error(err);
                showToast('ì˜µì…˜ ìˆ˜ì • ì‹¤íŒ¨', 'error');
            }
        }
        
        // ==================== ìƒí’ˆëª… ìˆ˜ì • ====================
        let currentEditTitleProductId = null;
        
        function openEditTitle(cnTitle, krTitle, productId) {
            currentEditTitleProductId = productId;
            document.getElementById('edit-title-cn').value = cnTitle || '';
            document.getElementById('edit-title-kr').value = krTitle || '';
            document.getElementById('edit-title-modal').classList.add('show');
        }
        
        function closeEditTitleModal() {
            document.getElementById('edit-title-modal').classList.remove('show');
            currentEditTitleProductId = null;
        }
        
        async function saveEditedTitle() {
            const newCnTitle = document.getElementById('edit-title-cn').value.trim();
            const newKrTitle = document.getElementById('edit-title-kr').value.trim();
            const productId = currentEditTitleProductId; // ë¨¼ì € ì €ì¥
            
            if (!newCnTitle) {
                showToast('ìƒí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }
            
            try {
                await fetch(`/api/products/extracted/${productId}/title`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: newCnTitle, title_kr: newKrTitle })
                });
                
                showToast('ìƒí’ˆëª…ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
                closeEditTitleModal();
                await showDetail(productId); // await ì¶”ê°€
                loadProducts();
            } catch (err) {
                console.error(err);
                showToast('ìƒí’ˆëª… ìˆ˜ì • ì‹¤íŒ¨', 'error');
            }
        }
        
        // ==================== ì‚­ì œ í™•ì¸ ====================
        let deleteProductId = null;
        
        function openDeleteConfirm(productId) {
            deleteProductId = productId;
            document.getElementById('delete-confirm-modal').classList.add('show');
        }
        
        function closeDeleteConfirmModal() {
            document.getElementById('delete-confirm-modal').classList.remove('show');
            deleteProductId = null;
        }
        
        async function confirmDeleteProduct() {
            if (!deleteProductId) return;
            
            try {
                await fetch(`/api/products/extracted/${deleteProductId}`, { method: 'DELETE' });
                closeDeleteConfirmModal();
                closeModal();
                loadProducts();
                showToast('ìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            } catch (err) {
                showToast('ì‚­ì œ ì‹¤íŒ¨', 'error');
            }
        }
        
        // ==================== ì¹´í…Œê³ ë¦¬ ì„ íƒ ====================
        let categoryProductId = null;
        let categoryData = null;
        let selectedCategory = null;
        let searchTimeout = null;
        
        // ì¹´í…Œê³ ë¦¬ ëª¨ë‹¬ ì—´ê¸°
        async function openCategoryModal(productId) {
            categoryProductId = productId;
            selectedCategory = null;
            document.getElementById('category-save-btn').disabled = true;
            document.getElementById('category-breadcrumb').textContent = 'ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
            document.getElementById('category-search').value = '';
            document.getElementById('category-search-results').style.display = 'none';
            document.getElementById('category-level-1').innerHTML = '<div style="padding:20px;text-align:center;color:#888;">ë¡œë”© ì¤‘...</div>';
            document.getElementById('category-level-2').innerHTML = '';
            document.getElementById('category-level-3').innerHTML = '';
            document.getElementById('category-level-4').innerHTML = '';
            
            document.getElementById('category-modal').classList.add('show');
            
            // ì¹´í…Œê³ ë¦¬ ë°ì´í„° ë¡œë“œ
            await loadCategoryData();
        }
        
        // ì¹´í…Œê³ ë¦¬ ëª¨ë‹¬ ë‹«ê¸°
        function closeCategoryModal() {
            document.getElementById('category-modal').classList.remove('show');
            categoryProductId = null;
            selectedCategory = null;
        }
        
        // ì¹´í…Œê³ ë¦¬ ë°ì´í„° ë¡œë“œ
        async function loadCategoryData() {
            try {
                const res = await fetch('/api/naver/categories');
                const data = await res.json();
                
                if (data.error) {
                    document.getElementById('category-level-1').innerHTML = `
                        <div style="padding:20px;text-align:center;color:#dc3545;">
                            <p>âš ï¸ ${data.error}</p>
                            ${data.hint ? `<p style="font-size:12px;margin-top:10px;">${data.hint}</p>` : ''}
                        </div>`;
                    return;
                }
                
                categoryData = data;
                renderMainCategories();
                
            } catch (err) {
                console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì˜¤ë¥˜:', err);
                document.getElementById('category-level-1').innerHTML = `
                    <div style="padding:20px;text-align:center;color:#dc3545;">
                        ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
                    </div>`;
            }
        }
        
        // ëŒ€ë¶„ë¥˜ ë Œë”ë§
        function renderMainCategories() {
            if (!categoryData || !categoryData.tree) return;
            
            const container = document.getElementById('category-level-1');
            container.innerHTML = categoryData.tree.map(cat => `
                <div class="category-item has-children" onclick="selectMainCategory('${cat.id}', '${cat.name.replace(/'/g, "\\'")}')">
                    ${cat.name}
                </div>
            `).join('');
        }
        
        // ëŒ€ë¶„ë¥˜ ì„ íƒ
        async function selectMainCategory(id, name) {
            // UI ì—…ë°ì´íŠ¸
            document.querySelectorAll('#category-level-1 .category-item').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            document.getElementById('category-level-2').innerHTML = '';
            document.getElementById('category-level-3').innerHTML = '';
            document.getElementById('category-level-4').innerHTML = '';
            document.getElementById('category-breadcrumb').textContent = name;
            selectedCategory = null;
            document.getElementById('category-save-btn').disabled = true;

            // íŠ¸ë¦¬ì—ì„œ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ì°¾ê¸°
            const mainCat = categoryData.tree.find(c => c.id === id);
            if (!mainCat) return;

            const container = document.getElementById('category-level-2');

            // ìì‹ì´ ì—†ìœ¼ë©´ ì„ íƒ ê°€ëŠ¥
            if (!mainCat.children || mainCat.children.length === 0) {
                container.innerHTML = '<div style="padding:20px;text-align:center;color:#888;">í•˜ìœ„ ì¹´í…Œê³ ë¦¬ ì—†ìŒ</div>';
                selectedCategory = { id: mainCat.id, name: mainCat.name, wholeCategoryName: mainCat.wholeCategoryName };
                document.getElementById('category-save-btn').disabled = false;
                return;
            }

            // ì¤‘ë¶„ë¥˜ í‘œì‹œ
            container.innerHTML = mainCat.children.map(cat => `
                <div class="category-item ${cat.children && cat.children.length > 0 ? 'has-children' : ''}"
                     onclick="selectMidCategory('${cat.id}', '${cat.name.replace(/'/g, "\\'")}', '${cat.wholeCategoryName?.replace(/'/g, "\\'")}')">
                    ${cat.name}
                </div>
            `).join('');
        }
        
        // ì¤‘ë¶„ë¥˜ ì„ íƒ
        function selectMidCategory(id, name, wholeName) {
            // UI ì—…ë°ì´íŠ¸
            document.querySelectorAll('#category-level-2 .category-item').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            document.getElementById('category-level-3').innerHTML = '';
            document.getElementById('category-level-4').innerHTML = '';
            document.getElementById('category-breadcrumb').textContent = wholeName;

            // íŠ¸ë¦¬ì—ì„œ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ì°¾ê¸° (ëª¨ë“  depth ê²€ìƒ‰)
            let midCat = null;
            for (const root of categoryData.tree) {
                if (root.children) {
                    midCat = root.children.find(c => c.id === id);
                    if (midCat) break;
                }
            }

            if (!midCat) return;

            const container = document.getElementById('category-level-3');

            // ìì‹ì´ ì—†ìœ¼ë©´ ì„ íƒ ê°€ëŠ¥
            if (!midCat.children || midCat.children.length === 0) {
                selectedCategory = { id: midCat.id, name: midCat.name, wholeCategoryName: midCat.wholeCategoryName };
                document.getElementById('category-save-btn').disabled = false;
                return;
            }

            // ì†Œë¶„ë¥˜ í‘œì‹œ
            container.innerHTML = midCat.children.map(cat => `
                <div class="category-item ${cat.children && cat.children.length > 0 ? 'has-children' : ''}"
                     onclick="selectSubCategory('${cat.id}', '${cat.name.replace(/'/g, "\\'")}', '${cat.wholeCategoryName?.replace(/'/g, "\\'")}')">
                    ${cat.name}
                </div>
            `).join('');

            // ì†Œë¶„ë¥˜ê°€ ìˆìœ¼ë©´ ì„ íƒ ë¶ˆê°€
            selectedCategory = null;
            document.getElementById('category-save-btn').disabled = true;
        }
        
        // ì†Œë¶„ë¥˜ ì„ íƒ
        function selectSubCategory(id, name, wholeName) {
            document.querySelectorAll('#category-level-3 .category-item').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            document.getElementById('category-level-4').innerHTML = '';
            document.getElementById('category-breadcrumb').textContent = wholeName;

            // íŠ¸ë¦¬ì—ì„œ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ì°¾ê¸° (3-depth ê²€ìƒ‰)
            let subCat = null;
            for (const root of categoryData.tree) {
                if (!root.children) continue;
                for (const mid of root.children) {
                    if (!mid.children) continue;
                    subCat = mid.children.find(c => c.id === id);
                    if (subCat) break;
                }
                if (subCat) break;
            }

            if (!subCat) return;

            const container = document.getElementById('category-level-4');

            // ìì‹ì´ ì—†ìœ¼ë©´ ì„ íƒ ê°€ëŠ¥
            if (!subCat.children || subCat.children.length === 0) {
                selectedCategory = { id: subCat.id, name: subCat.name, wholeCategoryName: subCat.wholeCategoryName };
                document.getElementById('category-save-btn').disabled = false;
                return;
            }

            // ì„¸ë¶„ë¥˜(4ë‹¨ê³„) í‘œì‹œ
            container.innerHTML = subCat.children.map(cat => `
                <div class="category-item ${cat.children && cat.children.length > 0 ? 'has-children' : ''}"
                     onclick="selectDetailCategory('${cat.id}', '${cat.name.replace(/'/g, "\\'")}', '${cat.wholeCategoryName?.replace(/'/g, "\\'")}')">
                    ${cat.name}
                </div>
            `).join('');

            // ì„¸ë¶„ë¥˜ê°€ ìˆìœ¼ë©´ ì„ íƒ ë¶ˆê°€
            selectedCategory = null;
            document.getElementById('category-save-btn').disabled = true;
        }

        // ì„¸ë¶„ë¥˜(4ë‹¨ê³„) ì„ íƒ
        function selectDetailCategory(id, name, wholeName) {
            document.querySelectorAll('#category-level-4 .category-item').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            document.getElementById('category-breadcrumb').textContent = wholeName;

            // íŠ¸ë¦¬ì—ì„œ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ì°¾ê¸° (4-depth ê²€ìƒ‰)
            let detailCat = null;
            for (const root of categoryData.tree) {
                if (!root.children) continue;
                for (const mid of root.children) {
                    if (!mid.children) continue;
                    for (const sub of mid.children) {
                        if (!sub.children) continue;
                        detailCat = sub.children.find(c => c.id === id);
                        if (detailCat) break;
                    }
                    if (detailCat) break;
                }
                if (detailCat) break;
            }

            if (!detailCat) return;

            // 5ë‹¨ê³„ ì´ìƒì´ ìˆìœ¼ë©´ ì„ íƒ ë¶ˆê°€
            if (detailCat.children && detailCat.children.length > 0) {
                showToast('ìµœí•˜ìœ„ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
                selectedCategory = null;
                document.getElementById('category-save-btn').disabled = true;
            } else {
                selectedCategory = { id: detailCat.id, name: detailCat.name, wholeCategoryName: detailCat.wholeCategoryName };
                document.getElementById('category-save-btn').disabled = false;
            }
        }
        
        // ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰
        async function searchCategories(query) {
            if (searchTimeout) clearTimeout(searchTimeout);
            
            if (!query || query.length < 2) {
                document.getElementById('category-search-results').style.display = 'none';
                document.getElementById('category-level-1').parentElement.style.display = '';
                document.getElementById('category-level-2').parentElement.style.display = '';
                document.getElementById('category-level-3').parentElement.style.display = '';
                document.getElementById('category-level-4').parentElement.style.display = '';
                return;
            }

            searchTimeout = setTimeout(async () => {
                try {
                    const res = await fetch(`/api/naver/categories/search?q=${encodeURIComponent(query)}`);
                    const data = await res.json();

                    // ê³„ì¸µ ì„ íƒ ìˆ¨ê¸°ê³  ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
                    document.getElementById('category-level-1').parentElement.style.display = 'none';
                    document.getElementById('category-level-2').parentElement.style.display = 'none';
                    document.getElementById('category-level-3').parentElement.style.display = 'none';
                    document.getElementById('category-level-4').parentElement.style.display = 'none';
                    
                    const container = document.getElementById('category-search-results');
                    container.style.display = 'block';
                    
                    if (data.categories.length === 0) {
                        container.innerHTML = '<div style="padding:40px;text-align:center;color:#888;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                        return;
                    }
                    
                    container.innerHTML = data.categories.map(cat => `
                        <div class="category-search-item" onclick="selectSearchedCategory('${cat.id}', '${cat.name.replace(/'/g, "\\'")}', '${cat.wholeCategoryName?.replace(/'/g, "\\'")}')">
                            <div style="font-weight:600;">${cat.name}</div>
                            <div class="path">${cat.wholeCategoryName}</div>
                        </div>
                    `).join('');
                    
                } catch (err) {
                    console.error('ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ ì˜¤ë¥˜:', err);
                }
            }, 300);
        }
        
        // ê²€ìƒ‰ëœ ì¹´í…Œê³ ë¦¬ ì„ íƒ
        function selectSearchedCategory(id, name, wholeName) {
            selectedCategory = { id, name, wholeCategoryName: wholeName };
            document.getElementById('category-breadcrumb').textContent = wholeName;
            document.getElementById('category-save-btn').disabled = false;
            
            // ì„ íƒ í‘œì‹œ
            document.querySelectorAll('.category-search-item').forEach(el => el.style.background = '');
            event.currentTarget.style.background = '#e8f5e9';
        }
        
        // ì¹´í…Œê³ ë¦¬ ì €ì¥
        async function saveCategory() {
            if (!selectedCategory || !categoryProductId) return;

            try {
                const res = await fetch(`/api/products/extracted/${categoryProductId}/category`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        categoryId: selectedCategory.id,
                        categoryName: selectedCategory.name,
                        wholeCategoryName: selectedCategory.wholeCategoryName
                    })
                });

                if (!res.ok) throw new Error('ì €ì¥ ì‹¤íŒ¨');

                const savedProductId = categoryProductId;

                showToast('ì¹´í…Œê³ ë¦¬ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
                closeCategoryModal();

                // ì•½ê°„ì˜ ë”œë ˆì´ í›„ ìƒì„¸ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                setTimeout(async () => {
                    await showDetail(savedProductId);
                }, 100);

            } catch (err) {
                console.error('ì¹´í…Œê³ ë¦¬ ì €ì¥ ì˜¤ë¥˜:', err);
                showToast('ì¹´í…Œê³ ë¦¬ ì €ì¥ ì‹¤íŒ¨', 'error');
            }
        }
        
        document.getElementById('modal').onclick = (e) => {
            if (e.target.id === 'modal') closeModal();
        };
        document.onkeydown = (e) => {
            if (e.key === 'Escape') {
                closeModal();
                closeEditImageModal();
                closeEditOptionModal();
                closeEditTitleModal();
                closeDeleteConfirmModal();
                closeCategoryModal();
            }
        };
    </script>
</body>
</html>
